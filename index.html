<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <title>sy</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      height: 100vh;
      width: 100vw;
      background-color: #fff;
      overflow: hidden;
      position: relative;
      touch-action: none;
    }
    
    .start-btn {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      padding: 16px 32px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
      transition: all 0.3s ease;
      z-index: 9999;
    }
    
    .start-btn:hover {
      background-color: #2980b9;
      transform: translate(-50%, -50%) scale(1.05);
    }
    
    .start-btn:active {
      transform: translate(-50%, -50%) scale(0.98);
    }
    
    .image-box {
      position: absolute;
      border-radius: 6px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.3);
      overflow: hidden;
      opacity: 0;
      transform: scale(0.7);
    }
    
    .image-box img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    
    .final-image {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%) scale(0);
      opacity: 0;
      border-radius: 8px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
      z-index: 100;
    }
    
    .final-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      border-radius: 8px;
    }
    
    .final-text {
      position: absolute;
      left: 50%;
      text-align: center;
      color: #333;
      font-size: 24px;
      font-weight: bold;
      opacity: 0;
      transform: translateX(-50%) translateY(20px);
      z-index: 101;
      white-space: nowrap;
    }

    /* 音乐控制按钮 */
    .music-control {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      z-index: 9998;
      transition: all 0.3s ease;
    }
    
    .music-control:hover {
      transform: scale(1.1);
    }
    
    .music-icon {
      width: 0;
      height: 0;
      border-style: solid;
      border-width: 8px 0 8px 14px;
      border-color: transparent transparent transparent #3498db;
    }
    
    .music-paused .music-icon {
      position: relative;
      border: none;
    }
    
    .music-paused .music-icon::before,
    .music-paused .music-icon::after {
      content: '';
      position: absolute;
      width: 5px;
      height: 16px;
      background-color: #3498db;
    }
    
    .music-paused .music-icon::before {
      left: -10px;
      top: -8px;
    }
    
    .music-paused .music-icon::after {
      left: -2px;
      top: -8px;
    }

    @media (max-width: 480px) {
      .image-box {
        border-radius: 4px;
      }
      
      .start-btn {
        padding: 12px 24px;
        font-size: 20px;
      }
      
      .final-image {
        width: 200px;
        height: 200px;
      }
      
      .final-text {
        color:rgb(255, 153, 170);
        font-size: 35px;
        top: calc(50% + 120px);
      }
    }
    
    @media (min-width: 481px) {
      .final-image {
        width: 280px;
        height: 280px;
      }
      
      .final-text {
        font-size: 24px;
        top: calc(50% + 160px);
      }
    }
  </style>
</head>
<body>

  <!-- 开始按钮 -->
  <button class="start-btn">打开</button>

  <!-- 音乐控制按钮 -->
  <div class="music-control" id="musicControl">
    <div class="music-icon"></div>
  </div>

  <!-- 背景音乐 -->
  <audio id="backgroundMusic" loop>
    <source src="./img/子弥 - 所念皆星河.mp3" type="audio/mpeg">
     您的浏览器不支持音频播放
   </audio>
  
  <!-- 结束时显示的中心图片容器 -->
  <div class="final-image" id="finalImage">
    <img src="" alt="最终图片" id="finalImageSrc">
  </div>
  
  <!-- 最终图片下方的文字 -->
  <div class="final-text" id="finalText">To my 秋</div>

  <script>
    // 最终图片路径
    const finalImagePath = './img/275a25fff4c2569d52d8c7a8c0da64fe.jpg';
    
    // 其他图片资源列表
    const imageSources = [
      './img/1.jpg', './img/2.jpg', './img/3.jpg', './img/4.jpg', './img/5.jpg',
      './img/6.jpg', './img/7.jpg', './img/8.jpg', './img/9.jpg', './img/10.jpg',
      './img/11.jpg', './img/12.jpg', './img/13.jpg', './img/14.jpg', './img/15.jpg',
      './img/16.jpg', './img/17.jpg', './img/18.jpg', './img/19.jpg', './img/20.jpg',
      './img/21.jpg', './img/22.jpg', './img/23.jpg', './img/24.jpg', './img/25.jpg',
      './img/26.jpg', './img/27.jpg', './img/28.jpg', './img/29.jpg', './img/30.jpg',
      './img/31.jpg', './img/32.jpg', './img/33.jpg', './img/34.jpg', './img/35.jpg',
      './img/36.jpg', './img/37.jpg', './img/38.jpg', './img/39.jpg', './img/40.jpg'
    ];
    
    // 元素获取
    const allImages = [];
    let config = {};
    const startBtn = document.querySelector('.start-btn');
    const finalImage = document.getElementById('finalImage');
    const finalImageImg = document.getElementById('finalImageSrc');
    const finalText = document.getElementById('finalText');
    const backgroundMusic = document.getElementById('backgroundMusic');
    const musicControl = document.getElementById('musicControl');
    
    // 音乐控制功能
    function toggleMusic() {
      if (backgroundMusic.paused) {
        backgroundMusic.play().catch(e => console.log('播放失败:', e));
        musicControl.classList.remove('music-paused');
      } else {
        backgroundMusic.pause();
        musicControl.classList.add('music-paused');
      }
    }
    
    // 绑定音乐控制按钮事件
    musicControl.addEventListener('click', toggleMusic);
    
    // 获取随机图片地址
    function getRandomImage() {
      const randomIndex = Math.floor(Math.random() * imageSources.length);
      return imageSources[randomIndex];
    }
    
    // 获取随机位置
    function getRandomPos(size) {
      const viewportWidth = document.documentElement.clientWidth;
      const viewportHeight = document.documentElement.clientHeight;
      return {
        x: Math.random() * (viewportWidth - size),
        y: Math.random() * (viewportHeight - size)
      };
    }
    
    // 获取屏幕中心位置
    function getCenterPos(size) {
      const viewportWidth = document.documentElement.clientWidth;
      const viewportHeight = document.documentElement.clientHeight;
      return {
        x: (viewportWidth - size) / 2,
        y: (viewportHeight - size) / 2
      };
    }
    
    // 创建单个图片元素并设置浮现动画
    function createAnimatedImage(index) {
      const isMobile = window.innerWidth < 768;
      const baseSize = isMobile ? 80 : 60;
      const sizeRange = isMobile ? 40 : 80;
      
      const startSize = baseSize + Math.random() * sizeRange;
      const endSize = isMobile ? 10 : 5;
      
      const box = document.createElement('div');
      box.className = 'image-box';
      box.style.width = `${startSize}px`;
      box.style.height = `${startSize}px`;
      
      box.dataset.startSize = startSize;
      box.dataset.endSize = endSize;
      
      const img = document.createElement('img');
      img.src = getRandomImage();
      img.alt = `图片 ${index + 1}`;
      img.onerror = () => {
        box.style.backgroundColor = `rgb(${Math.random()*255}, ${Math.random()*255}, ${Math.random()*255})`;
      };
      
      box.appendChild(img);
      
      const startPos = getRandomPos(startSize);
      box.style.left = `${startPos.x}px`;
      box.style.top = `${startPos.y}px`;
      box.dataset.startX = startPos.x;
      box.dataset.startY = startPos.y;
      
      const centerPos = getCenterPos(endSize);
      box.dataset.targetX = centerPos.x;
      box.dataset.targetY = centerPos.y;
      
      box.style.zIndex = index;
      
      document.body.appendChild(box);
      allImages.push(box);
      
      setTimeout(() => {
        box.animate([
          { opacity: 0, transform: `scale(0.7)` },
          { opacity: 1, transform: `scale(1)` }
        ], {
          duration: config.fadeInTime,
          fill: 'forwards',
          easing: 'ease-out'
        });
      }, index * config.spawnInterval);
    }
    
    // 启动退场动画
    function startExitAnimation() {
      allImages.forEach((box, index) => {
        setTimeout(() => {
          const startSize = parseFloat(box.dataset.startSize);
          const endSize = parseFloat(box.dataset.endSize);
          const startX = parseFloat(box.dataset.startX);
          const startY = parseFloat(box.dataset.startY);
          const targetX = parseFloat(box.dataset.targetX);
          const targetY = parseFloat(box.dataset.targetY);
          
          box.animate([
            { 
              left: `${startX}px`, 
              top: `${startY}px`,
              width: `${startSize}px`,
              height: `${startSize}px`,
              opacity: 1,
              transform: 'scale(1)'
            },
            { 
              left: `${targetX}px`, 
              top: `${targetY}px`,
              width: `${endSize}px`,
              height: `${endSize}px`,
              opacity: 0,
              transform: 'scale(0.3)'
            }
          ], {
            duration: config.moveTime,
            fill: 'forwards',
            easing: 'cubic-bezier(0.72, -0.02, 1.00, 0.64)'
          });
          
          setTimeout(() => box.remove(), config.moveTime);
        }, index * config.moveInterval);
      });
      
      const exitTotalTime = (allImages.length - 1) * config.moveInterval + config.moveTime;
      
      setTimeout(() => {
        showFinalImage();
      }, exitTotalTime);
    }
    
    // 显示最终图片和文字
    function showFinalImage() {
      finalImageImg.src = finalImagePath;
      finalImageImg.onerror = () => {
        console.error('最终图片加载失败，请检查路径是否正确');
        finalImage.style.backgroundColor = '#f0f0f0';
      };
      
      const imageAnim = finalImage.animate([
        { opacity: 0, transform: 'translate(-50%, -50%) scale(0)' },
        { opacity: 1, transform: 'translate(-50%, -50%) scale(1)' }
      ], {
        duration: 1000,
        fill: 'forwards',
        easing: 'ease-out'
      });
      
      imageAnim.onfinish = () => {
        setTimeout(() => {
          finalText.animate([
            { opacity: 0, transform: 'translateX(-50%) translateY(20px)' },
            { opacity: 1, transform: 'translateX(-50%) translateY(0)' }
          ], {
            duration: 800,
            fill: 'forwards',
            easing: 'ease-out'
          });
        }, 300);
      };
    }
    
    // 初始化动画 - 点击打开按钮时触发音乐播放
    function initAnimation() {
      // 关键：在用户点击事件中播放音乐（符合浏览器自动播放政策）
      backgroundMusic.play().then(() => {
        console.log('音乐播放成功');
        musicControl.classList.remove('music-paused');
      }).catch(e => {
        console.log('音乐播放需要用户交互，可点击右上角音乐按钮手动播放:', e);
      });
      
      // 隐藏开始按钮
      startBtn.animate([
        { opacity: 1, transform: 'translate(-50%, -50%) scale(1)' },
        { opacity: 0, transform: 'translate(-50%, -50%) scale(0.8)' }
      ], {
        duration: 300,
        fill: 'forwards',
        easing: 'ease-out'
      }).onfinish = () => {
        startBtn.style.display = 'none';
      };
      
      // 重置文字状态
      finalText.style.opacity = '0';
      finalText.style.transform = 'translateX(-50%) translateY(20px)';
      
      // 清空之前的元素
      document.querySelectorAll('.image-box').forEach(box => box.remove());
      allImages.length = 0;
      finalImage.style.transform = 'translate(-50%, -50%) scale(0)';
      finalImage.style.opacity = '0';
      
      const isMobile = window.innerWidth < 768;
      
      config = {
        count: isMobile ? 75: 70,
        spawnInterval: isMobile ? 450 : 200,
        fadeInTime: 800,
        globalStayTime: 2000,
        moveTime: isMobile ? 1200 : 1500,
        moveInterval: isMobile ? 100 : 150
      };
      
      for (let i = 0; i < config.count; i++) {
        createAnimatedImage(i);
      }
      
      const lastFadeFinishTime = (config.count - 1) * config.spawnInterval + config.fadeInTime;
      
      setTimeout(() => {
        startExitAnimation();
      }, lastFadeFinishTime + config.globalStayTime);
    }
    
    // 绑定开始按钮事件 - 点击时同时启动动画和音乐
    startBtn.addEventListener('click', initAnimation);
    
    // 处理窗口大小变化
    window.addEventListener('resize', () => {
      if (startBtn.style.display !== 'none' && allImages.length === 0) {
        return;
      }
    });
  </script>
</body>
</html>